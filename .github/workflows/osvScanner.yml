name: OSV-Scanner (SCA)

on:
  push:
    branches: [ main ]


permissions:
  actions: read
  contents: read
  security-events: write

jobs:
  scan:
    uses: google/osv-scanner-action/.github/workflows/osv-scanner-reusable.yml@v2.3.3
    # Optionnel : personnaliser le scan
    with:
      scan-args: |-
        --recursive
        ./
      # Optionnel : fail si vuln√©rabilit√© trouv√©e (par d√©faut: true)
      fail-on-vuln: true

  notify:
    needs: scan
    if: failure()
    runs-on: ubuntu-latest

    steps:
      - name: Send Discord notification
        run: |
          curl -H "Content-Type: application/json" \
          -d '{
                "embeds": [{
                  "title": "üö® OSV Scan FAILED",
                  "color": 16711680,
                  "fields": [
                    {"name": "Repository", "value": "${{ github.repository }}", "inline": true},
                    {"name": "Branch", "value": "${{ github.ref_name }}", "inline": true},
                    {"name": "Commit", "value": "${{ github.sha }}", "inline": false},
                    {"name": "Actor", "value": "${{ github.actor }}", "inline": true}
                  ]
                }]
              }' \
          ${{ secrets.DISCORD_WEBHOOK_URL_CI }}